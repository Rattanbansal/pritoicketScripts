#!/bin/bash

# Define your order IDs here as a space-separated list
order_ids="172981915251133 172982980702418 172984112936517 172985318767108 172985342704061 172986575184286 172986750287954 172986970401447 172987530196401 172987822824406 172988652327920 172989017578408 172989450942920 172989573982516 172992895853872 172993126766395 172993855703663 172994188833966 172994289463527 172994797343451 172995050139117 172995426524028 172995665311475 172995758479602 172996772455944 172996831437393 172997212481541 172997275775204 172997306580762 172997316561790 172997423888014 172997650878937 172997911815810 172998168016032 173001788855180 173001954651433 173002012046184 173002890644298 173002935418756 173003043074255 173003337898360 173003680494608 173004213440126 173004236984222 173004493507074 173005004243807 173005074227090 173005278285576 173005375351663 173005569211955 173005692280636 173005839280089 173005922726718 173006090257477 173006373568740 173006445118837 173006452996311 173006482467076 173006724143970 173006750824929 173007031549268 173007078446919 173010852518231 173010992693534 173011260675578 173011365983140 173011375040026 173011640291049 173011713345394 173012088452606 173012448881192 173012769811295 173013047948216 173013184172458 173013906518125 173014176796779 173014228457277 173014233193203 173014252568000 173014385548766 173014624875857 173014749779661 173014826016202 173014874069876 173015014100978 173015074469131 173018545472250 173019101578180 173019265160732 173019496245484 173020155137939 173020235097933 173020458218099 173021423382592 173021490582317 173021828377092 173021960747366 173022279471056 173022294397404 173022416685628 173022428709513 173022490133370 173023003771732 173023084146504 173023188351701 173023245084744 173023404026297 173023568809681 173023642903805 173023899659311 173027367612887 173028083071111 173028177305712 173028886964023 173028995230330 173029277805580 173029445220429 173030014821836 173030497791088 173030552776395 173031168211283 173031491813969 173031649457304 173031653622069 173031823916566 173031926541923 173031929754617 173031932154331 173031954432329 173036227222306 173036282318951 173036459285879 173036564517178 173037152480317 173037269161602 173037536514360 173037563263597 173039887967748 173039993665666 173040209968957 173040272159829 173040951275256 173040961871390 173040964373709 173041015521198 173041087487574 173041131968988 173041697486250 173042067344853 173044614225213 173044839002954 173045138288724 173045300445910 173045321700695 173045511779834 173045615102013 173045618832849 173045648680490 173045711565913 173046588945378 173046814022484 173047116676780 173047150342691 173047210997392 173047305945399 173048097830255 173048186770695 173049432048440 173049704930711 173050148871819 173050300681751 173050704965119 173053429999894 173053714797931 173053732214802 173053748805087 173053988928421 173054076088761 173054121158538 173054196324440 173054197810244 173054236887292 173054268569720 173054293452006 173054524327159 173054573562335 173054665015202 173054789012829 173054897449234 173054994231940 173055023645961 173055026607161 173055056583383 173055204463903 173055337122956 173055419381171 173055633997210 173055753093082 173055866244240 173055890852015 173055908539865 173055937996597 173056006150336 173056031435522 173056152793304 173056242945819 173057046936317 173057261449630 173057276971775 173057532003895 173057564332192 173057672896803 173058202329482 173058203501026 173058244560872 173058244716237 173058255021039 173058357023842 173058385992941 173058469660362 173058707674970 173062165153135 173063111968003 173063228997495 173063330336128 173063350904246 173063519842359 173063527464116 173063674846771 173063878026473 173064085575593 173064247629131 173064308367502 173064450774693 173064479538283 173064543998324 173064593682339 173064645138592 173064811749548 173064989484618 173064996659235 173064997895709 173065032213056 173065032242787 173065216202081 173065437030484 173065454514362 173065483285048 173065535281315 173065572544176 173065629397577 173065795880441 173065806757128 173065897602920 173065966418528 173065969812152 173066022691765 173066038825081 173066054887223 173066225895237 173066401702505 173066434274482 173066502803283 173066547480758 173066769552734 173066958760065 173067008451739 173067042605502 173067060617730 173067281884523 173067521942279 173070678489426 173070751744149 173071031161117 173071056017453 173071092261566 173071375477714 173071581048365 173071891519049 173071933009806 173072136682790 173072298438117 173072329706240 173072688586140 173072838859940 173072877944073 173072943474848 173073058854269 173073406516486 173073473290977 173073600445405 173073626352568 173073647390304 173073845650543 173074135879880 173074267373757 173074274632500 173074742025263 173074902871559 173075032351917 173075088896882 173075190892377 173075349048672 173075584202671 173075734215583 173075785961428 173076238290229 173077061907915 173079181387200 173079479648521 173079872109549 173079943221670 173079991452375 173080087803988 173080978868020 173081193703064 173081203493423 173081209307451 173081290027279 173081292284936 173081393494400 173081913325631 173082096799879 173082691175788 173082897292055 173082913195986 173083053937237 173083190660434 173083459790375 173083560072726 173083585497677 173083590519942 173083687111600 173083999745598 173084003978455 173084030442081 173084321159822 173084420874584 173084610174692 173084698593965 173087206681914 173087937801917 173088416464653 173088489268823 173088902817830 173088941853923 173088957283864 173089103103030 173089504874815 173089709542853 173089909314396 173089938317583 173090088026292 173090594517107 173090767849405 173090803014302 173090987285569 173091320945337 173091481017684 173091635654870 173091711936217 173091791776010 173091932472461 173092445451902 173092525593372 173092556335722 173092569339780 173092596772305 173092599017700 173092604392411 173092619851627 173092623761899 173092777291312 173092796807856 173092801100513 173092802578271 173092894430839"

# Write the header to the CSV file
# echo "order_id,currency,price_total" > "$output_file"

id_token_here="AMf-vBxfT0bM6pH_dI_9eF4DF2l44E4SrMOum_2i-XLfQPdWTHJIcnWQRLikLMwQsxtWuayzec95IS5VZBFEupO8ducZQARmt8IgG7RlVu7JugfT6C4SXZfYgxTvAVSU21y3PxXM8L5HlboqpiRtO2GIEnQnQ9tuDU5imvJimlXu2p1rGnSH2oJTFiQ0OlwWa5Rf_YabdKa4alxTc_pVnXVqYC0iW9PynuAFheDlnkxbBd47POVn0VYvVfTPg9x-1ifL7HcQa_3HB05oXpy1YBsheFPPkdkHeqVOetp6UhgGzFn3lOvxnrjuF78yXkCEcxykA0h8HavN4ePMoM-nzP4NMloPJtZV9foy4BOPD-LkO9HKIOEIcEjA_o8b7Vt1kLn_aKu_yX50DYZmNuiaXNWtnHXHlW5mSiiYkAHiFsEBylBGXTsJ0VCtcaBa5491YDflPwLWATfj"

vpn_connection_name_a="pfSense-UDP4-1194-rattan1-config"
vpn_connection_name_b="pfSense-UDP4-1194-rattan2-config"

check_vpn_connection() {
    if nmcli connection show --active | grep -q "$vpn_connection_name_b"; then
        echo "VPN ($vpn_connection_name_b) is active."
    elif nmcli connection show --active | grep -q "$vpn_connection_name_a"; then
        echo "VPN ($vpn_connection_name_a) is active. Disconnecting it."
        sudo nmcli connection down $vpn_connection_name_a
        echo "rattan22024" | sudo nmcli --ask connection up $vpn_connection_name_b
        if nmcli connection show --active | grep -q "$vpn_connection_name_b"; then
            echo "VPN ($vpn_connection_name_b) is now connected."
            return 0
        else
            echo "Failed to connect VPN ($vpn_connection_name_b). Exiting with Condition 2."
            exit 1
        fi
    else
        echo "VPN ($vpn_connection_name_b) is not active. Connecting to the VPN."
        echo "rattan22024" | sudo nmcli --ask connection up $vpn_connection_name_b
        echo "----------- Aboive Error Message-----------"
        if nmcli connection show --active | grep -q "$vpn_connection_name_b"; then
            echo "VPN ($vpn_connection_name_b) is now connected."
            return 0
        else
            echo "Failed to connect VPN ($vpn_connection_name_b). Exiting with condition 3."
            exit 1
        fi
    fi
}

# check_vpn_connection
# Loop through each order ID in the list
for order_id in $order_ids; do

    echo "http://localhost82.com/prioticket-refund/public/refundOrderFullQuantity/$order_id?refresh_token=$id_token_here&skip_third_party=0"
    
    response=$(curl -s "http://localhost82.com/prioticket-refund/public/refundOrderFullQuantity/$order_id?refresh_token=$id_token_here&skip_third_party=0")

    echo "$order_id" >> matchdata2.txt
    
    echo "$response" >> response2.json
    sleep 9
done

# jq -r '.response.data.order | "\(.order_reference): \(.order_status)"' response.json
