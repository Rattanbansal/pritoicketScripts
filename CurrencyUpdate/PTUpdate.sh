#!/bin/bash

DB_HOST='10.10.10.19'
DB_USER='pip'
DB_PASS='pip2024##'
DB_NAME='rattan'
BATCH_SIZE=5

mysqlHost="prodrds.prioticket.com"
mysqlUser=pipeuser
mysqlPassword=d4fb46eccNRAL
mysqlDatabase="prioprodrds"

SECDATABASE='priopassdb'
SECHOST='production-secondary-db-node.cluster-ck6w2al7sgpk.eu-west-1.rds.amazonaws.com'
SECUSER='pipeuser'
SECPASSWORD='d4fb46eccNRAL'

transaction_ids="170004549602523001 170004549602523002 170004549602523003 170004549602523004 170004567634731001 170004567634731002 170004567634731003 170004567634731004 170124500722280001 170124500722280002 170124500722280003 170124500722280004 170332775411678001 170332775411678002 170332775411678003 170332775411678004 170340305504322001 170340305504322002 170340305504322003 170340305504322004 170340318736344001 170340318736344002 170340318736344003 170340318736344004 170366419695223001 170366419695223002 170366419695223003 170366419695223004 170426921381080001 170426921381080002 170426921381080003 170426921381080004 170435956565766001 170464694337423001 170464694337423002 170464694337423003 170464694337423004 170478890505119001 170504673677563001 170575657384822001 170575657384822002 170575657384822003 170575657384822004 170575657384822005 170575657384822006 170677246747417001 170677246747417002 170688394561227001 170688394561227002 170704135585615001 170704135585615002 170712393524340001 170712393524340002 170712393524340003 170712393524340004 170720974055446001 170720974055446002 170720974055446003 170720974055446004 170720986815477001 170720986815477002 170720986815477003 170720986815477004 170740377336918001 170740377336918002 170748658794497001 170748658794497002 170748658794497003 170748658794497004 170748674039933001 170748674039933002 170748674039933003 170748674039933004 170748681533449001 170748681533449002 170748681533449003 170748681533449004 170748691781475001 170748691781475002 170755934078428001 170755934078428002 170781180819495001 170781180819495002 170781180819495003 170781180819495004 170817426424330001 170817426424330002 170817451717625001 170817451717625002 170817451717625003 170817490420205001 170817490420205002 170850362739307001 170850362739307002 170850362739307003 170850362739307004 170850378792959001 170850378792959002 170850378792959003 170850378792959004 170850384948081001 170858631920805001 170858631920805002 170858631920805003 170858631920805004 170858631920805005 170858631920805006 170858631920805007 170858631920805008 170858631920805009 170858631920805010 170858631920805011 170858631920805012 170858643030735001 170858643030735002 170858643030735003 170858643030735004 170867590199601001 170867590199601002 170910772119503001 170910772119503002 170929417636438001 170929417636438002 170929417636438003 170929417636438004 170988595533753001 170988595533753002 170988595533753003 171014607238576001 171014607238576002 171014607238576003 171022826600732001 171022826600732002 171022826600732003 171022826600732004 171022826600732005 171022826600732006 171022826600732007 171022826600732008 171091956267986001 171091956267986002 171091956267986003 171091956267986004 171091956267986005 171091956267986006 171091956267986007 171091956267986008 171101057140482001 171101057140482002 171101057140482003 171101057140482004 171109562477064001 171109562477064002 171109562477064003 171109562477064004 171109581274742001 171109581274742002 171109581274742003 171109581274742004 171109581274742005 171109581274742006 171109581274742007 171109581274742008 171145468988515001 171145468988515002 171161335792192001 171161335792192002 171170551882499001 171170551882499002 171170551882499003 171170551882499004 171170551882499005 171204434928262001 171204434928262002 171204434928262003 171204434928262004 171204434928262005 171204434928262006 171213272932338001 171213272932338002 171213272932338003 171213272932338004 171213272932338005 171213272932338006 171213272932338007 171213272932338008 171221382093992001 171221382093992002 171221382093992003 171221389591021001 171221389591021002 171221389591021003 171248853095918001 171248853095918002 171248863440360001 171248863440360002 171248872097215001 171248872097215002 171248872097215003 171248872097215004 171248881150110001 171248881150110002 171248881150110003 171248881150110004 171248888428852001 171248888428852002 171248888428852003 171248888428852004 171248895129743001 171248895129743002 171248895129743003 171248895129743004 171264918840137001 171264918840137002 171264918840137003 171264918840137004 171281788902561001 171281788902561002 171301185647153001 171301185647153002 171301185647153003 171301185647153004 171301185647153005 171301185647153006 171316656325099001 171316656325099002 171316656325099003 171316656325099004 171385616037206001 171385616037206002 171385616037206003 171385616037206004 171385616037206005 171385616037206006 171385616037206007 171385616037206008 171437523098691001 171437523098691002 171437523098691003 171437523098691004 171454822702687001 171454822702687002 171454822702687003 171454822702687004 171515839279718001 171515839279718002 171515839279718003 171515839279718004 171515839279718005 171515839279718006 171515839279718007 171515839279718008 171575765376346001 171575765376346002 171575786628757001 171575786628757002 171575786628757003 171584497160141001 171584497160141002 171584497160141003 171584497160141004 171584497160141005 171584497160141006 171584497160141007 171584497160141008 171584514616588001 171584514616588002 171584514616588003 171584514616588004 171584514616588005 171584514616588006 171584514616588007 171584514616588008 171584514616588009 171584514616588010 171584514616588011 171584514616588012 171627837374008001 171627837374008002 171688304142780001 171688304142780002 171688304142780003 171688304142780004 171688304142780005 171688304142780006 171688304142780007 171688304142780008 171739911129259001 171739911129259002 171739911129259003 171739911129259004 171739944909162001 171739944909162002 171739944909162003 171739944909162004 171739944909162005 171739944909162006 171739944909162007 171739944909162008 171766632376591001 171766632376591002 171766632376591003 171766632376591004 171766632376591005 171766632376591006 171766632376591007 171766632376591008 171766632376591009 171766632376591010 171766632376591011 171766632376591012 171784300695746001 171784300695746002 171784300695746003 171784300695746004 171784307158844001 171784307158844002 171792181675979001 171792181675979002 171792181675979003 171792181675979004 171895812730940001 171895823430317001 171895823430317002 171895823430317003 171947653886864001 171947653886864002 171947653886864003 171947653886864004 171955935245768001 171955935245768002 171955941860930001 171955941860930002 172008028862821001 172008028862821002 172051359944818001 172051359944818002 172051359944818003 172051359944818004 172051369671599001 172051369671599002 172051369671599003 172051369671599004 172051369671599005 172051369671599006 172059541908965001 172059541908965002 172059541908965003 172059541908965004 172076915021455001 172076915021455002 172120456282032001 172120456282032002 172163216169850001 172163216169850002 172197849545606001 172197849545606002 172223854877710001 172223854877710002 172223854877710003 172223854877710004 172249601478056001 172249601478056002 172413790963534001 172413790963534002 172422502588532001 172422502588532002 172422502588532003 172422502588532004 172439910333812001 172439910333812002 172466840352927001 172466840352927002 172474275640906001 172474275640906002 172554888085716001 172554888085716002 172621563969940001 172621563969940002 172717608864869001 172717608864869002 172717660882302001 172717660882302002 172717660882302003 172717660882302004 172742536702857001 172742536702857002 172776690732817001 172776690732817002 172776690732817003 172776690732817004 172776690732817005 172776690732817006 172785292668403001 172785292668403002 172785292668403003 172785292668403004"

for transaction_id in ${transaction_ids}

do

    echo "$transaction_id"

        

    update_query_pt="UPDATE prepaid_tickets pt join (SELECT transaction_id,vt_group_no,version,ticketId,MAX(CASE WHEN row_type = '1' THEN partner_net_price ELSE 0 END) AS sale_price,MAX(CASE WHEN row_type = '2' THEN partner_net_price ELSE 0 END) AS purchase_price,MAX(CASE WHEN row_type = '3' THEN partner_net_price ELSE 0 END) AS distributor_fee,MAX(CASE WHEN row_type = '4' THEN partner_net_price ELSE 0 END) AS hgs_fee,MAX(CASE WHEN row_type = '17' THEN partner_net_price ELSE 0 END) AS merchant_fee,MAX(CASE WHEN row_type = '1' THEN partner_gross_price ELSE 0 END) AS sale_priceg,MAX(CASE WHEN row_type = '2' THEN partner_gross_price ELSE 0 END) AS purchase_priceg,MAX(CASE WHEN row_type = '3' THEN partner_gross_price ELSE 0 END) AS distributor_feeg,MAX(CASE WHEN row_type = '4' THEN partner_gross_price ELSE 0 END) AS hgs_feeg FROM visitor_tickets WHERE transaction_id in ($transaction_id) and col2 != '2' and action_performed like '%AWTCommission' GROUP BY vt_group_no,transaction_id,ticketpriceschedule_id, version) as aggt ON pt.visitor_group_no = aggt.vt_group_no AND pt.prepaid_ticket_id = aggt.transaction_id and ABS(pt.version-aggt.version) = '0' SET pt.net_price = aggt.sale_price, pt.price = aggt.sale_priceg,pt.oroginal_price = (aggt.sale_priceg+pt.discount),pt.admin_currency_code = 'USD', pt.museum_net_fee = aggt.purchase_price,pt.distributor_net_fee = aggt.distributor_fee,pt.hgs_net_fee = aggt.hgs_fee,pt.museum_gross_fee = aggt.purchase_priceg,pt.distributor_gross_fee = aggt.distributor_feeg,pt.hgs_gross_fee = aggt.hgs_feeg, pt.action_performed = concat(pt.action_performed, ', AWTCommission');select ROW_COUNT();"

    echo "------$(date '+%Y-%m-%d %H:%M:%S.%3N')--------" >> pt_update_query.sql

    echo "$update_query_pt" >> pt_update_query.sql

    mysql -h"$mysqlHost" -u"$mysqlUser" -p"$mysqlPassword" -D"$mysqlDatabase" -sN -e "$update_query_pt"
    mysql -h"$SECHOST" -u"$SECUSER" -p"$SECPASSWORD" -D"$SECDATABASE" -sN -e "$update_query_pt"

    # curl https://report.prioticket.com/Insert_api_data_nested/api_results_v2/$transaction_id

    sleep 2

done
