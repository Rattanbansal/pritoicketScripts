## Join Primary and secondary template

select base.*, base1.template_id as secondary_template_id, base1.ticket_id as secondary_ticket_id, base1.publish_catalog as secondaryPublishCatalog, base1.is_pos_list as secondary_is_pos_list, base1.template_level_tickets_id from (SELECT template_id, ticket_id, publish_catalog, is_pos_list FROM template_level_tickets where template_id = '1527' and deleted = '0') as base left join (SELECT template_level_tickets_id,template_id, ticket_id, publish_catalog, is_pos_list FROM template_level_tickets where template_id = '1455' and deleted = '0') as base1 on base.ticket_id = base1.ticket_id;


## Insert query for the primary and secondary_template

insert into template_level_tickets (template_id, ticket_id, is_pos_list, is_suspended, created_at, market_merchant_id, content_description_setting, last_modified_at, catalog_id, merchant_admin_id, publish_catalog, product_verify_status, deleted) select '1455' as template_id, ticket_id, is_pos_list, is_suspended, created_at, market_merchant_id, content_description_setting, last_modified_at, catalog_id, merchant_admin_id, publish_catalog, product_verify_status, deleted from (select base.*, base1.template_id as secondary_template_id, base1.ticket_id as secondary_ticket_id, base1.publish_catalog as secondaryPublishCatalog from (SELECT * FROM template_level_tickets where template_id = '1527' and deleted = '0') as base left join (SELECT template_id, ticket_id, publish_catalog FROM template_level_tickets where template_id = '1455' and deleted = '0') as base1 on base.ticket_id = base1.ticket_id) as base2 where secondary_template_id is NULL; 

## Update Publish catalog

update template_level_tickets tltf join (select base.*, base1.template_id as secondary_template_id, base1.ticket_id as secondary_ticket_id, base1.publish_catalog as secondaryPublishCatalog, base1.is_pos_list as secondary_is_pos_list, base1.template_level_tickets_id from (SELECT template_id, ticket_id, publish_catalog, is_pos_list FROM template_level_tickets where template_id = '1527' and deleted = '0') as base left join (SELECT template_level_tickets_id,template_id, ticket_id, publish_catalog, is_pos_list FROM template_level_tickets where template_id = '1455' and deleted = '0') as base1 on base.ticket_id = base1.ticket_id where base.publish_catalog != base1.publish_catalog) as cal on cal.template_level_tickets_id = tltf.template_level_tickets_id set tltf.publish_catalog = cal.publish_catalog



## Check missing entries in secondary pricelist and Insert them

insert into channel_level_commission (created_at, channel_id, ticket_id, ticketpriceschedule_id, museum_name, ticket_title, ticket_type, ticket_scan_price, ticket_list_price, ticket_new_price, ticket_discount, is_discount_in_percent, ticket_gross_price, ticket_tax_value, ticket_tax_id, ticket_net_price, museum_commission_old, museum_gross_commission, museum_net_commission, museum_commission_tax_value, museum_commission_tax_id, subtotal_net_amount, subtotal_gross_amount, subtotal_tax_value, subtotal_tax_id, is_combi_ticket_allowed, is_combi_discount, tickets_for_combi_discount, combi_discount_gross_amount, combi_discount_net_amount, combi_discount_tax_value, combi_discount_tax_id, commission_updated_at, ip_address, hotel_prepaid_commission_percentage, hotel_postpaid_commission_percentage, hotel_commission_tax_id, hotel_commission_tax_value, hgs_prepaid_commission_percentage, hgs_postpaid_commission_percentage, hgs_commission_tax_id, hgs_commission_tax_value, merchant_gross_commission, is_adjust_pricing, is_custom_setting, apply_service_tax, external_product_id, account_number, chart_number, deleted, market_merchant_id, merchant_net_commission, merchant_admin_id, merchant_admin_name, is_cluster_ticket_added, default_listing, catalog_id, last_modified_at, resale_percentage, is_resale_percentage, merchant_fee_percentage, is_merchant_fee_percentage, is_hotel_prepaid_commission_percentage, commission_on_sale_price, hotel_commission_gross_price, hotel_commission_net_price, hgs_commission_gross_price, hgs_commission_net_price, product_type, currency, resale_currency_level, resale_commission, affected_before_date, affected_date, is_active, publish_level, channel_level, reseller_id, own_merchant_id, discount_label, discount_setting_type) select CURRENT_TIMESTAMP as created_at,'1307' as channel_id, ticket_id, ticketpriceschedule_id, museum_name, ticket_title, ticket_type, ticket_scan_price, ticket_list_price, ticket_new_price, ticket_discount, is_discount_in_percent, ticket_gross_price, ticket_tax_value, ticket_tax_id, ticket_net_price, museum_commission_old, museum_gross_commission, museum_net_commission, museum_commission_tax_value, museum_commission_tax_id, subtotal_net_amount, subtotal_gross_amount, subtotal_tax_value, subtotal_tax_id, is_combi_ticket_allowed, is_combi_discount, tickets_for_combi_discount, combi_discount_gross_amount, combi_discount_net_amount, combi_discount_tax_value, combi_discount_tax_id, commission_updated_at,'203.203.203.11' as ip_address, hotel_prepaid_commission_percentage, hotel_postpaid_commission_percentage, hotel_commission_tax_id, hotel_commission_tax_value, hgs_prepaid_commission_percentage, hgs_postpaid_commission_percentage, hgs_commission_tax_id, hgs_commission_tax_value, merchant_gross_commission, is_adjust_pricing, is_custom_setting, apply_service_tax, external_product_id, account_number, chart_number, deleted, market_merchant_id, merchant_net_commission, merchant_admin_id, merchant_admin_name, is_cluster_ticket_added, default_listing, catalog_id,CURRENT_TIMESTAMP as last_modified_at, resale_percentage, is_resale_percentage, merchant_fee_percentage, is_merchant_fee_percentage, is_hotel_prepaid_commission_percentage, commission_on_sale_price, hotel_commission_gross_price, hotel_commission_net_price, hgs_commission_gross_price, hgs_commission_net_price, product_type, currency, resale_currency_level, resale_commission, affected_before_date, affected_date, is_active, publish_level, channel_level, reseller_id, own_merchant_id, discount_label, discount_setting_type from (select clcc.*, secondary.channel_level_commission_id as secondary_id, secondary.ticket_id as secondary_ticket_id, secondary.ticketpriceschedule_id as secondary_ticketpriceschedule_id from (select clc.* from channel_level_commission clc join (select * from template_level_tickets where template_id = '1527' and deleted = '0' and publish_catalog = '1') as tlt on clc.ticket_id = tlt.ticket_id where clc.channel_id = '1382' and clc.deleted = '0' and clc.is_adjust_pricing = '1') as clcc left join (select * from channel_level_commission where channel_id = '1307' and deleted = '0' and is_adjust_pricing = '1') as secondary on clcc.ticket_id = secondary.ticket_id and clcc.ticketpriceschedule_id = secondary.ticketpriceschedule_id and secondary.channel_id = '1307' and clcc.resale_currency_level = secondary.resale_currency_level) as base where secondary_id is NULL;
